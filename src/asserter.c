/**
 * @file 
 * @brief See @ref asserter.h
 * 
 * @author Ian Ress
 * @version 0.1
 * @date 2024-03-02
 * @copyright Copyright (c) 2024
 */



/*--------------------------------------------------------------------------------------------------------------------------*/
/*----------------------------------------------------------- INCLUDES -----------------------------------------------------*/
/*--------------------------------------------------------------------------------------------------------------------------*/

/* Translation unit. */
#include <ecu/asserter.h>



/*--------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------- GLOBAL VARIABLES -------------------------------------------------*/
/*--------------------------------------------------------------------------------------------------------------------------*/

/* When using C99, static asserts are not natively supported. Therefore ECU_STATIC_ASSERT() 
macro uses ecu_static_assert_do_not_use_[] array to produce compilation errors. Therefore
this array must actually be defined somewhere since it will be referenced whenever
ECU_STATIC_ASSERT() is called. */
#ifdef ECU_USING_C99_STATIC_ASSERT_DO_NOT_USE_
const char ecu_static_assert_do_not_use_[1] = {0};
#endif



/*---------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------- STATIC FUNCTION DECLARATIONS -------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------------------*/

static void default_assert_handler(void);



/*---------------------------------------------------------------------------------------------------------------------------*/
/*--------------------------------------------------- STATIC FUNCTION DEFINITIONS -------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------------------*/

static void default_assert_handler(void)
{
#if !defined(NDEBUG)
    while (1)
    {
        /* Permanently hang to inspect call stack. */
    }
#endif
}



/*---------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------- PRIVATE FUNCTIONS -------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------------------*/

void ecu_assert_do_not_use(struct ecu_assert_functor *me, const char *file, int line)
{
    if (me)
    {
        if (me->handler)
        {
            (*me->handler)(me, file, line); /* user-defined handler. */
        }
        else
        {
            default_assert_handler();
        }
    }
    else
    {
        default_assert_handler();
    }
}
